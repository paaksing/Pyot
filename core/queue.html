<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Queue | Pyot</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="2020 High level Python framework for the Riot Games API, support for AsyncIO and Django">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/Pyot/assets/css/0.styles.e9a76978.css" as="style"><link rel="preload" href="/Pyot/assets/js/app.7963ecf4.js" as="script"><link rel="preload" href="/Pyot/assets/js/2.829d7f43.js" as="script"><link rel="preload" href="/Pyot/assets/js/18.3d6d5c02.js" as="script"><link rel="preload" href="/Pyot/assets/js/3.57890298.js" as="script"><link rel="prefetch" href="/Pyot/assets/js/10.0a5b06b6.js"><link rel="prefetch" href="/Pyot/assets/js/11.25aa1585.js"><link rel="prefetch" href="/Pyot/assets/js/12.0c1b569a.js"><link rel="prefetch" href="/Pyot/assets/js/13.a94456bb.js"><link rel="prefetch" href="/Pyot/assets/js/14.6abf7ddd.js"><link rel="prefetch" href="/Pyot/assets/js/15.982e025b.js"><link rel="prefetch" href="/Pyot/assets/js/16.5bb02b4e.js"><link rel="prefetch" href="/Pyot/assets/js/17.2f559ee6.js"><link rel="prefetch" href="/Pyot/assets/js/19.748aeb2a.js"><link rel="prefetch" href="/Pyot/assets/js/20.c403d7b6.js"><link rel="prefetch" href="/Pyot/assets/js/21.abb54b9f.js"><link rel="prefetch" href="/Pyot/assets/js/22.b022febe.js"><link rel="prefetch" href="/Pyot/assets/js/23.15dd0891.js"><link rel="prefetch" href="/Pyot/assets/js/24.f38ec7fd.js"><link rel="prefetch" href="/Pyot/assets/js/25.176823c4.js"><link rel="prefetch" href="/Pyot/assets/js/26.64589a1c.js"><link rel="prefetch" href="/Pyot/assets/js/27.78ac1bad.js"><link rel="prefetch" href="/Pyot/assets/js/28.36adbc51.js"><link rel="prefetch" href="/Pyot/assets/js/29.295e2707.js"><link rel="prefetch" href="/Pyot/assets/js/30.743e2fbd.js"><link rel="prefetch" href="/Pyot/assets/js/31.dcfaf66c.js"><link rel="prefetch" href="/Pyot/assets/js/32.945351f5.js"><link rel="prefetch" href="/Pyot/assets/js/33.acf34331.js"><link rel="prefetch" href="/Pyot/assets/js/34.1be0aa28.js"><link rel="prefetch" href="/Pyot/assets/js/35.e85c6d21.js"><link rel="prefetch" href="/Pyot/assets/js/36.41969382.js"><link rel="prefetch" href="/Pyot/assets/js/37.17a9f604.js"><link rel="prefetch" href="/Pyot/assets/js/38.03da2b82.js"><link rel="prefetch" href="/Pyot/assets/js/39.1e2b35ec.js"><link rel="prefetch" href="/Pyot/assets/js/4.5f602039.js"><link rel="prefetch" href="/Pyot/assets/js/40.17d4b384.js"><link rel="prefetch" href="/Pyot/assets/js/41.f4461f37.js"><link rel="prefetch" href="/Pyot/assets/js/42.5d56af9f.js"><link rel="prefetch" href="/Pyot/assets/js/43.d501295d.js"><link rel="prefetch" href="/Pyot/assets/js/44.4abee53a.js"><link rel="prefetch" href="/Pyot/assets/js/45.6e416bbf.js"><link rel="prefetch" href="/Pyot/assets/js/46.07af3d27.js"><link rel="prefetch" href="/Pyot/assets/js/47.1a58bccb.js"><link rel="prefetch" href="/Pyot/assets/js/48.4049c6ea.js"><link rel="prefetch" href="/Pyot/assets/js/49.b9539eab.js"><link rel="prefetch" href="/Pyot/assets/js/5.0f4f46df.js"><link rel="prefetch" href="/Pyot/assets/js/50.38c1abc8.js"><link rel="prefetch" href="/Pyot/assets/js/51.38b4a3b7.js"><link rel="prefetch" href="/Pyot/assets/js/52.ecdb1382.js"><link rel="prefetch" href="/Pyot/assets/js/53.cb9de460.js"><link rel="prefetch" href="/Pyot/assets/js/54.2a3a8793.js"><link rel="prefetch" href="/Pyot/assets/js/55.e1eca1a9.js"><link rel="prefetch" href="/Pyot/assets/js/56.134b134c.js"><link rel="prefetch" href="/Pyot/assets/js/57.17d12620.js"><link rel="prefetch" href="/Pyot/assets/js/58.aedd4d57.js"><link rel="prefetch" href="/Pyot/assets/js/59.7d73eefa.js"><link rel="prefetch" href="/Pyot/assets/js/6.c25ae119.js"><link rel="prefetch" href="/Pyot/assets/js/60.0e674117.js"><link rel="prefetch" href="/Pyot/assets/js/61.913c5778.js"><link rel="prefetch" href="/Pyot/assets/js/62.8b905394.js"><link rel="prefetch" href="/Pyot/assets/js/63.2725df59.js"><link rel="prefetch" href="/Pyot/assets/js/64.7ba8c9d6.js"><link rel="prefetch" href="/Pyot/assets/js/65.36864d9b.js"><link rel="prefetch" href="/Pyot/assets/js/66.5f4b3af5.js"><link rel="prefetch" href="/Pyot/assets/js/67.dbaf1f73.js"><link rel="prefetch" href="/Pyot/assets/js/68.00b47bf8.js"><link rel="prefetch" href="/Pyot/assets/js/69.af19c337.js"><link rel="prefetch" href="/Pyot/assets/js/7.0c431f95.js"><link rel="prefetch" href="/Pyot/assets/js/70.a762419e.js"><link rel="prefetch" href="/Pyot/assets/js/71.560fed6d.js"><link rel="prefetch" href="/Pyot/assets/js/72.a7049f8d.js"><link rel="prefetch" href="/Pyot/assets/js/73.bc572115.js"><link rel="prefetch" href="/Pyot/assets/js/74.c946c3f6.js"><link rel="prefetch" href="/Pyot/assets/js/75.ddb6af6a.js"><link rel="prefetch" href="/Pyot/assets/js/76.b0250fde.js"><link rel="prefetch" href="/Pyot/assets/js/77.c634416b.js"><link rel="prefetch" href="/Pyot/assets/js/78.bc0ac861.js"><link rel="prefetch" href="/Pyot/assets/js/79.9fed35d5.js"><link rel="prefetch" href="/Pyot/assets/js/8.4989b0f6.js"><link rel="prefetch" href="/Pyot/assets/js/80.a1057da4.js"><link rel="prefetch" href="/Pyot/assets/js/81.59a60dff.js"><link rel="prefetch" href="/Pyot/assets/js/82.acbedcc2.js"><link rel="prefetch" href="/Pyot/assets/js/83.1ae23b2c.js"><link rel="prefetch" href="/Pyot/assets/js/84.6ab338b6.js"><link rel="prefetch" href="/Pyot/assets/js/85.af7dcb35.js"><link rel="prefetch" href="/Pyot/assets/js/86.1e5568a6.js"><link rel="prefetch" href="/Pyot/assets/js/87.82d92c26.js"><link rel="prefetch" href="/Pyot/assets/js/88.23b267cf.js"><link rel="prefetch" href="/Pyot/assets/js/89.05a779d7.js"><link rel="prefetch" href="/Pyot/assets/js/9.343a03f6.js"><link rel="prefetch" href="/Pyot/assets/js/90.2b8ac25c.js"><link rel="prefetch" href="/Pyot/assets/js/91.985dd7ab.js"><link rel="prefetch" href="/Pyot/assets/js/92.4367d63c.js"><link rel="prefetch" href="/Pyot/assets/js/93.de482a31.js"><link rel="prefetch" href="/Pyot/assets/js/94.b81498af.js">
    <link rel="stylesheet" href="/Pyot/assets/css/0.styles.e9a76978.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Pyot/" class="home-link router-link-active"><!----> <span class="site-name">Pyot</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Pyot/core/" class="nav-link router-link-active">
  Core
</a></div><div class="nav-item"><a href="/Pyot/pipeline/" class="nav-link">
  Pipeline
</a></div><div class="nav-item"><a href="/Pyot/models/" class="nav-link">
  Models
</a></div><div class="nav-item"><a href="/Pyot/stores/" class="nav-link">
  Stores
</a></div><div class="nav-item"><a href="/Pyot/limiters/" class="nav-link">
  Limiters
</a></div><div class="nav-item"><a href="/Pyot/utils/" class="nav-link">
  Utils
</a></div><div class="nav-item"><a href="/Pyot/topics/" class="nav-link">
  Topics
</a></div><div class="nav-item"><a href="/Pyot/devs/" class="nav-link">
  Developers
</a></div><div class="nav-item"><a href="https://github.com/paaksing/pyot" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Pyot/core/" class="nav-link router-link-active">
  Core
</a></div><div class="nav-item"><a href="/Pyot/pipeline/" class="nav-link">
  Pipeline
</a></div><div class="nav-item"><a href="/Pyot/models/" class="nav-link">
  Models
</a></div><div class="nav-item"><a href="/Pyot/stores/" class="nav-link">
  Stores
</a></div><div class="nav-item"><a href="/Pyot/limiters/" class="nav-link">
  Limiters
</a></div><div class="nav-item"><a href="/Pyot/utils/" class="nav-link">
  Utils
</a></div><div class="nav-item"><a href="/Pyot/topics/" class="nav-link">
  Topics
</a></div><div class="nav-item"><a href="/Pyot/devs/" class="nav-link">
  Developers
</a></div><div class="nav-item"><a href="https://github.com/paaksing/pyot" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Introduction</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Pyot/core/" aria-current="page" class="sidebar-link">Pyot</a></li><li><a href="/Pyot/core/installation.html" class="sidebar-link">Installation Guide</a></li><li><a href="/Pyot/core/startup.html" class="sidebar-link">Quick Start Guide</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Integrations</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Pyot/core/django.html" class="sidebar-link">Django</a></li><li><a href="/Pyot/core/celery.html" class="sidebar-link">Celery</a></li><li><a href="/Pyot/core/syot.html" class="sidebar-link">Syot</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Cores</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Pyot/core/apiobjects.html" class="sidebar-link">Objects</a></li><li><a href="/Pyot/core/settings.html" class="sidebar-link">Settings</a></li><li><a href="/Pyot/core/gatherer.html" class="sidebar-link">Gatherer</a></li><li><a href="/Pyot/core/queue.html" aria-current="page" class="active sidebar-link">Queue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Pyot/core/queue.html#pyot-queue-api" class="sidebar-link">Pyot Queue API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Pyot/core/queue.html#init-workers-int-25-maxsize-int-none-log-level-int-10" class="sidebar-link">__init__(workers: int = 25, maxsize: int = None, log_level: int = 10)</a></li><li class="sidebar-sub-header"><a href="/Pyot/core/queue.html#put-coro-coroutine-delay-float-0" class="sidebar-link">put(coro: Coroutine, delay: float = 0)</a></li><li class="sidebar-sub-header"><a href="/Pyot/core/queue.html#join" class="sidebar-link">join() :</a></li><li class="sidebar-sub-header"><a href="/Pyot/core/queue.html#sid" class="sidebar-link">sid</a></li><li class="sidebar-sub-header"><a href="/Pyot/core/queue.html#responses" class="sidebar-link">responses</a></li></ul></li><li class="sidebar-sub-header"><a href="/Pyot/core/queue.html#example-usage" class="sidebar-link">Example Usage</a></li></ul></li><li><a href="/Pyot/core/exceptions.html" class="sidebar-link">Exceptions</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Migrations</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Pyot/core/v2tov3.html" class="sidebar-link">Version 2 → 3</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="queue"><a href="#queue" class="header-anchor">#</a> Queue</h1> <p>This is an object that executes coroutines in a queue/workers basic. Unlike Gatherer, this object creates true workers on the same thread, exposing the instance as a context manager that can be passed freely to coroutines, mostly for accessing the sid of the queue which is created similarly to Gatherer.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>This object is only accessible as a context manager with the <code>async with</code> syntax for safeguarding session closing and workers joining.</p></div> <div class="custom-block warning"><p class="custom-block-title">RELEVANT TOPIC</p> <ul><li><a href="/Pyot/topics/why_not_asyncio_gather.html">Why not use asyncio.gather ?</a>.</li></ul></div> <h2 id="pyot-queue-api"><a href="#pyot-queue-api" class="header-anchor">#</a> Pyot Queue API</h2> <p>A managed Queue on top of asyncio.Queue. This Queue is only usable as a context manager.</p> <p>Unlike Gatherer, Queue has real workers that act like consumers.
A session is created and accessible on a 'sid' attribute. The maxsize will default to workers * 2.
Normally the queue object will be passed down to coroutines to give access to session id or queue methods.</p> <div class="language-python line-numbers-mode"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br></div><pre class="language-python"><code><span class="token keyword">from</span> pyot<span class="token punctuation">.</span>core <span class="token keyword">import</span> Queue

<span class="token keyword">async</span> <span class="token keyword">with</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> quque<span class="token punctuation">:</span>
    <span class="token comment"># DO STUFF</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><h3 id="init-workers-int-25-maxsize-int-none-log-level-int-10"><a href="#init-workers-int-25-maxsize-int-none-log-level-int-10" class="header-anchor">#</a> <code>__init__(workers: int = 25, maxsize: int = None, log_level: int = 10)</code></h3> <ul><li><code>workers</code> <span class="badge warning" style="vertical-align:middle;" data-v-15b7b770>param</span> -&gt; <code>int</code>: Maximum number of workers to spawn for the queue. Increasing the number of workers may increase or decrease performance. Defaults to 25.</li> <li><code>log_level</code> <span class="badge warning" style="vertical-align:middle;" data-v-15b7b770>param</span> -&gt; <code>bool</code>: Set the log level for the Gatherer (does not affect pipeline logs). Defaults to 10 (DEBUG level).</li> <li><code>maxsize</code> <span class="badge warning" style="vertical-align:middle;" data-v-15b7b770>param</span> -&gt; <code>int</code>: Max size of the queue. Defaults to <code>workers * 2</code>.</li></ul></blockquote> <blockquote><h3 id="put-coro-coroutine-delay-float-0"><a href="#put-coro-coroutine-delay-float-0" class="header-anchor">#</a> <code>put(coro: Coroutine, delay: float = 0)</code> <span class="badge error" style="vertical-align:middle;" data-v-15b7b770>function</span> <span class="badge error" style="vertical-align:middle;" data-v-15b7b770>awaitable</span></h3> <p>Put a coroutine object to the queue. If the queue is full, it will wait for availability. A delay may be provided if desired for execution balancing.</p> <ul><li><code>coro</code> <span class="badge warning" style="vertical-align:middle;" data-v-15b7b770>param</span> -&gt; <code>Coroutine</code>: The coroutine to put on the queue.</li> <li><code>delay</code> <span class="badge warning" style="vertical-align:middle;" data-v-15b7b770>param</span> -&gt; <code>float</code>: The amount of delay in seconds before putting the coroutine into the queue. Defaults to 0.</li></ul></blockquote> <blockquote><h3 id="join"><a href="#join" class="header-anchor">#</a> <code>join()</code> <span class="badge error" style="vertical-align:middle;" data-v-15b7b770>function</span> <span class="badge error" style="vertical-align:middle;" data-v-15b7b770>awaitable</span>:</h3> <p>Block until all items in the queue have been gotten and processed. Empty the collected responses and returns them. NoneType and Exceptions are not collected, thus order of the responses may not correspond the put order.</p></blockquote> <blockquote><h3 id="sid"><a href="#sid" class="header-anchor">#</a> <code>sid</code> <span class="badge error" style="vertical-align:middle;" data-v-15b7b770>property</span></h3> <p>Property where the session id is stored, can be used to pass down to the Core objects <code>get()</code> to reuse a session.</p></blockquote> <blockquote><h3 id="responses"><a href="#responses" class="header-anchor">#</a> <code>responses</code> <span class="badge error" style="vertical-align:middle;" data-v-15b7b770>property</span></h3> <p>Property where all the responses are saved, unlike Gatherer, this property <strong><em>is not safe to access</em></strong> as it may have inconsistency.</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You can use the same queue to <code>join()</code> as many time as you want, this creates a nice way to do everything in a single Queue. For example, get ChallengerLeague -&gt; get all Summoners in the entries -&gt; pull match history of all the Summoners.</p> <p>It's best practice to pass the <code>sid</code> to the Core objects so that it can reuse a session, since creating a new session (created when no <code>sid</code> is provided) will cause some overhead.</p></div> <h2 id="example-usage"><a href="#example-usage" class="header-anchor">#</a> Example Usage</h2> <div class="language-python line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-python"><code><span class="token keyword">from</span> typing <span class="token keyword">import</span> List
<span class="token keyword">from</span> pyot<span class="token punctuation">.</span>models <span class="token keyword">import</span> lol
<span class="token keyword">from</span> pyot<span class="token punctuation">.</span>core <span class="token keyword">import</span> Queue
<span class="token keyword">from</span> pyot<span class="token punctuation">.</span>utils <span class="token keyword">import</span> FrozenGenerator<span class="token punctuation">,</span> shuffle_list

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">get_puuid</span><span class="token punctuation">(</span>queue<span class="token punctuation">:</span> Queue<span class="token punctuation">,</span> summoner<span class="token punctuation">:</span> lol<span class="token punctuation">.</span>Summoner<span class="token punctuation">)</span><span class="token punctuation">:</span>
    summoner <span class="token operator">=</span> <span class="token keyword">await</span> summoner<span class="token punctuation">.</span>get<span class="token punctuation">(</span>sid<span class="token operator">=</span>queue<span class="token punctuation">.</span>sid<span class="token punctuation">)</span>
    <span class="token keyword">return</span> summoner<span class="token punctuation">.</span>puuid

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">pull_puuids</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> queue<span class="token punctuation">:</span> <span class="token comment"># type: Queue</span>
        <span class="token keyword">await</span> queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>lol<span class="token punctuation">.</span>ChallengerLeague<span class="token punctuation">(</span>queue<span class="token operator">=</span><span class="token string">&quot;RANKED_SOLO_5x5&quot;</span><span class="token punctuation">,</span> platform<span class="token operator">=</span><span class="token string">&quot;na1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span>sid<span class="token operator">=</span>queue<span class="token punctuation">.</span>sid<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>lol<span class="token punctuation">.</span>MasterLeague<span class="token punctuation">(</span>queue<span class="token operator">=</span><span class="token string">&quot;RANKED_SOLO_5x5&quot;</span><span class="token punctuation">,</span> platform<span class="token operator">=</span><span class="token string">&quot;na1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span>sid<span class="token operator">=</span>queue<span class="token punctuation">.</span>sid<span class="token punctuation">)</span><span class="token punctuation">)</span>
        leagues <span class="token operator">=</span> <span class="token keyword">await</span> queue<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># type: List[lol.ChallengerLeague]</span>

        summoners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> league <span class="token keyword">in</span> leagues<span class="token punctuation">:</span>
            <span class="token keyword">for</span> entry <span class="token keyword">in</span> league<span class="token punctuation">.</span>entries<span class="token punctuation">:</span>
                summoners<span class="token punctuation">.</span>append<span class="token punctuation">(</span>entry<span class="token punctuation">.</span>summoner<span class="token punctuation">)</span>
        <span class="token comment"># Shuffles the list by platform to balance rate limits by region </span>
        <span class="token comment"># Also freezes the list to prevent mutation that causes memory leak</span>
        summoners <span class="token operator">=</span> FrozenGenerator<span class="token punctuation">(</span>shuffle_list<span class="token punctuation">(</span>summoners<span class="token punctuation">,</span> <span class="token string">&quot;platform&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> summoner <span class="token keyword">in</span> summoners<span class="token punctuation">:</span>
            <span class="token keyword">await</span> queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>get_puuid<span class="token punctuation">(</span>queue<span class="token punctuation">,</span> summoner<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">await</span> queue<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><div class="custom-block danger"><p class="custom-block-title">MEMORY AWARENESS</p> <p>The coroutine passed to the queue. Try your best to not return anything or return small objects, because <code>Queue</code> will save those returning values for the <code>join()</code>, meaning that memory can start to increase over time. Try to design the coroutines to consume the object instead.</p> <p>Assuming we want to gather 30k matches, take the following examples in term of memory usage</p> <ul><li><em><strong>BAD</strong></em></li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">get_matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    matches <span class="token operator">=</span> list_with_30k_match_timelines <span class="token comment"># &lt;-- Suppose</span>

    <span class="token keyword">async</span> <span class="token keyword">with</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> queue<span class="token punctuation">:</span> <span class="token comment"># type: Queue</span>
        <span class="token keyword">for</span> match <span class="token keyword">in</span> matches<span class="token punctuation">:</span>
            <span class="token keyword">await</span> queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>match<span class="token punctuation">.</span>get<span class="token punctuation">(</span>sid<span class="token operator">=</span>queue<span class="token punctuation">.</span>sid<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><em><strong>GOOD</strong></em></li></ul> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">get_matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    matches <span class="token operator">=</span> list_with_30k_match_timelines <span class="token comment"># &lt;-- Suppose</span>
    matches <span class="token operator">=</span> FrozenGenerator<span class="token punctuation">(</span>matches<span class="token punctuation">)</span> <span class="token comment"># Freezes the list to prevent mutation</span>

    <span class="token keyword">async</span> <span class="token keyword">with</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> queue<span class="token punctuation">:</span> <span class="token comment"># type: Queue</span>
        <span class="token keyword">for</span> match <span class="token keyword">in</span> matches<span class="token punctuation">:</span>
            <span class="token keyword">await</span> queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>consume_match<span class="token punctuation">(</span>queue<span class="token punctuation">,</span> match<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">consume_match</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> match<span class="token punctuation">)</span><span class="token punctuation">:</span>
    match<span class="token punctuation">.</span>get<span class="token punctuation">(</span>sid<span class="token operator">=</span>queue<span class="token punctuation">.</span>sid<span class="token punctuation">)</span> <span class="token comment"># pass the session to reuse</span>
    <span class="token comment"># ...</span>
    <span class="token comment"># Consume your match (e.g. get specific stat, mutate a dictionary, save to db, etc.) ...</span>
    <span class="token comment"># ...</span>
    <span class="token keyword">return</span> <span class="token boolean">None</span>
    <span class="token comment"># OR no return at all (When no return is stated, defaults to return None)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></div> <div class="custom-block tip"><p class="custom-block-title">DETAILS</p> <ul><li><code>FrozenGenerator</code> was used to isolate the Summoners objects so that it doesn't pass by reference; therefore, not mutating the original list and prevent possible memory leak.</li> <li><code>shuffle_list</code> was used to shuffle the list by <code>&quot;platform&quot;</code> to take advantage of crossing the waiting time on the rate limits for the different regions.</li> <li>A good use of inline type hinting can help you with IDE autocompletion. Note: You might not use this if responses contain more than 1 Pyot Core object type.</li></ul></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/15/2020, 4:44:15 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Pyot/core/gatherer.html" class="prev">
        Gatherer
      </a></span> <span class="next"><a href="/Pyot/core/exceptions.html">
        Exceptions
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Pyot/assets/js/app.7963ecf4.js" defer></script><script src="/Pyot/assets/js/2.829d7f43.js" defer></script><script src="/Pyot/assets/js/18.3d6d5c02.js" defer></script><script src="/Pyot/assets/js/3.57890298.js" defer></script>
  </body>
</html>
